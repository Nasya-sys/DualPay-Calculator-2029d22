<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DualPay Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --pink: #FFD1DC; --green: #228B22; }
        body { background-color: var(--pink); font-family: 'Montserrat', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; margin: 0; }
        .comfortaa { font-family: 'Comfortaa', cursive; }
        #bg-grid { position: fixed; top: -10%; left: -10%; width: 120%; height: 120%; display: grid; grid-template-columns: repeat(6, 1fr); z-index: -1; opacity: 0.3; transform: rotate(-10deg); pointer-events: none; }
        .symbol { display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--green); animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border-radius: 40px; border: 1px solid white; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 90%; max-width: 380px; padding: 2rem; }
        .input-main { background-color: var(--green) !important; color: white !important; border-radius: 15px 0 0 15px; }
        .btn-curr { background-color: #333; color: white; border-radius: 0 15px 15px 0; padding: 0 15px; font-weight: bold; }
        .tab-active { background-color: var(--green) !important; color: white !important; }
        #installBtn { background-color: var(--green); color: white; width: 100%; padding: 15px; border-radius: 20px; font-weight: bold; margin-top: 20px; transition: transform 0.2s; display: block; }
        #installBtn:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="bg-grid"></div>
    <main class="glass z-10 text-center">
        <h1 class="comfortaa text-[#228B22] text-2xl font-bold mb-6">DualPay Calculator</h1>
        
        <div class="mb-4 text-left">
            <label class="text-[10px] font-bold text-gray-500 uppercase ml-2">Сметка</label>
            <div class="flex h-12">
                <input type="number" id="bill" placeholder="0.00" class="w-full p-3 input-main outline-none font-bold text-xl">
                <button onclick="changeBillCurr()" id="billBtn" class="btn-curr">BGN</button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6 text-left">
            <div>
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-2">Платено лв</label>
                <input type="number" id="pBgn" placeholder="0.00" class="w-full p-3 rounded-xl border border-gray-200 outline-none text-center font-bold">
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-2">Платено €</label>
                <input type="number" id="pEur" placeholder="0.00" class="w-full p-3 rounded-xl border border-gray-200 outline-none text-center font-bold">
            </div>
        </div>

        <div id="res" class="hidden bg-white/50 p-4 rounded-3xl border border-white">
            <div class="flex justify-center gap-2 mb-2">
                <button onclick="setResCurr('BGN')" id="bBgn" class="px-4 py-1 rounded-lg text-xs font-bold bg-gray-200 tab-active">BGN</button>
                <button onclick="setResCurr('EUR')" id="bEur" class="px-4 py-1 rounded-lg text-xs font-bold bg-gray-200">EUR</button>
            </div>
            <div id="mainR" class="text-3xl font-bold text-[#228B22]">0.00 лв</div>
            <div id="subR" class="text-[10px] text-gray-400 font-bold uppercase">екв. 0.00 €</div>
        </div>

        <button id="installBtn">ИНСТАЛИРАЙ</button>
    </main>

    <script>
        const RATE = 1.95583;
        let bCurr = 'BGN', rCurr = 'BGN', deferredPrompt;

        const g = document.getElementById('bg-grid');
        for(let i=0; i<24; i++) {
            const s = document.createElement('div'); s.className='symbol'; s.innerText = i%2===0?'€':'лв';
            s.style.animationDelay = Math.random()*5+'s'; g.appendChild(s);
        }

        function changeBillCurr() { bCurr = bCurr==='BGN'?'EUR':'BGN'; document.getElementById('billBtn').innerText=bCurr; calc(); }
        function setResCurr(c) { rCurr = c; document.getElementById('bBgn').classList.toggle('tab-active', c==='BGN'); document.getElementById('bEur').classList.toggle('tab-active', c==='EUR'); calc(); }

        function calc() {
            const b = parseFloat(document.getElementById('bill').value)||0, pL = parseFloat(document.getElementById('pBgn').value)||0, pE = parseFloat(document.getElementById('pEur').value)||0;
            const bL = bCurr==='EUR' ? b*RATE : b, totalL = pL + (pE*RATE), diffL = totalL - bL;
            const rBox = document.getElementById('res');
            if(b > 0 && totalL > 0 && diffL >= -0.01) {
                rBox.classList.remove('hidden');
                const diffE = diffL / RATE;
                if(rCurr==='BGN') {
                    document.getElementById('mainR').innerText = diffL.toFixed(2) + ' лв';
                    document.getElementById('subR').innerText = 'екв. ' + diffE.toFixed(2) + ' €';
                } else {
                    document.getElementById('mainR').innerText = diffE.toFixed(2) + ' €';
                    document.getElementById('subR').innerText = 'екв. ' + diffL.toFixed(2) + ' лв';
                }
            } else { rBox.classList.add('hidden'); }
        }

        ['bill','pBgn','pEur'].forEach(id => document.getElementById(id).addEventListener('input', calc));

        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') document.getElementById('installBtn').style.display = 'none';
                deferredPrompt = null;
            } else {
                alert("За да инсталирате:\n1. Отворете в Chrome/Safari\n2. Натиснете 'Споделяне' или 'Меню'\n3. Изберете 'Add to Home Screen'");
            }
        });
    </script>
</body>
</html>
